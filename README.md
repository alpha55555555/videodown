# videodown - 强大的全能媒体下载器 (Advanced Media Downloader)

videodown 是一款基于 Android (Kotlin + Jetpack Compose) 开发的高级媒体下载工具，专为解决复杂场景下的视频下载需求而设计。除了传统的链接解析功能外，它还内置了强大的“网页嗅探器 (Smart Sniffer)”，能够自动捕获并下载网页中的视频和高清图片资源。

## ✨ 核心功能 (Key Features)

### 1. 多平台解析与后台下载 (NEW!)
*   **异步处理**: 点击“粘贴并解析下载”后，解析和下载任务将自动转入后台运行，用户无需在解析页面等待，极大地提升了使用效率。
*   **多任务并发**: 支持同时开启多个下载任务，每个任务独立运行，互不干扰。
*   **抖音/TikTok**: 支持分享链接的自动解析，可选择保留或去除水印。
*   **Twitter (X)**: 集成第三方 API，自动提取高质量视频地址。

### 2. 实时进度监控 (NEW!)
*   **可视化进度条**: 在“记录”页面，每个正在下载的任务都会显示实时的百分比进度条。
*   **非确定性下载支持**: 对于无法预知大小的文件，系统会自动显示循环加载动画，确保用户感知下载状态。

### 3. 智能任务管理 (Optimized)
*   **任务分组与重试**: 同一原始链接的任务会自动成组。支持**全组重新解析**（适用于链接过期）或**单项子任务重新下载**。
*   **复制链接 (NEW!)**: 在任务详情中，支持一键复制资源的真实下载链接。
*   **失败任务折叠**: 历史记录中，无效或失败资源会被自动归类并折叠，保持列表整洁。

### 4. 增强的 UI 交互 (NEW!)
*   **全屏滚动支持**: 所有功能页面（解析、记录、调试、设置）均已适配垂直滚动，确保在任何屏幕尺寸下都能完整显示。
*   **显式滚动条**: 引入了自定义的半透明滚动条指示器，在滚动时提供清晰的视觉反馈，提升长列表操作体验。

### 5. 智能资源过滤 (NEW!)
*   **Bilibili 深度过滤**: 针对 B站视频解析，自动识别并过滤掉不需要的背景图、存档封面、活动页图片（如 `hdslb.com/bfs/archive/` 等路径），确保资源列表只包含核心媒体内容。

### 6. 极致性能与稳定性 (Optimized)
*   **全局资源复用**: 采用全局 OkHttp 线程池和连接池，大幅降低多并发时的 CPU 和内存开销。
*   **双重超时保护**: 严格的连接 (30s) 和读取 (60s) 超时设置，彻底解决下载任务无限“转圈”假死的问题。
*   **UI 渲染优化**: 限制进度条刷新频率并采用后台 IO 存储历史记录，确保即使在多任务下载时 UI 依然丝滑顺畅。

### 5. 智能重下 (Smart Redownload)
*   **完整记录**: 本地持久化存储下载历史，包含标题、时间、状态和原始来源。
*   **智能重下**: 针对由原始链接（Blob/CDN）过期的视频，支持通过“原始分享链接”自动唤醒解析器重新获取最新地址。

## 📱 界面布局 (UI Structure)

应用采用底部导航栏设计，从左到右依次为：

1.  **设置 (Settings)**: 自定义文件存储路径。
2.  **调试 (Debug)**: 查看嗅探器捕获的实时资源列表，用于排查问题。
3.  **记录 (History)**: 查看已下载任务及其进度，支持点击预览和任务折叠。
4.  **解析 (Parser)**: 主页，提供链接输入、水印选项及后台解析控制。

## 🛠️ 技术栈 (Tech Stack)

*   **语言**: Kotlin
*   **UI 框架**: Jetpack Compose (Material Design 3)
*   **网络**: OkHttp (Global Singleton)
*   **并发管理**: Kotlin Coroutines

## 🚀 如何运行 (How to Run)

### 环境要求
*   Android Studio Iguana 或更高版本
*   Android SDK API 26+ (推荐 API 33)
*   JDK 17

### 步骤
1.  克隆或下载本项目。
2.  使用 Android Studio 打开项目根目录。
3.  等待 Gradle Sync 完成。
4.  点击运行 (Run 'app')。

## 📝 常见问题 (FAQ)

**Q: 为什么下载进度条有时不走？**
A: 这通常是因为服务器没有返回文件总大小。此时进度条会变为“不确定状态”的循环动画，只要动画在动，下载就在继续。

**Q: 如何查看被折叠的失败任务？**
A: 在“记录”页面找到带有红色标题的任务卡片，点击带有箭头的区域即可展开查看该链接下的所有失败尝试。

**Q: 支持哪些链接格式？**
A: 支持纯 URL (`https://...`) 或包含中文描述的分享文本（如抖音分享口令）。程序会自动正则提取其中的 URL。
