# TikDown - 强大的全能媒体下载器 (Advanced Media Downloader)

TikDown 是一款基于 Android (Kotlin + Jetpack Compose) 开发的高级媒体下载工具，专为解决复杂场景下的视频下载需求而设计。除了传统的链接解析功能外，它还内置了强大的“网页嗅探器 (Smart Sniffer)”，能够自动捕获并下载网页中的视频和高清图片资源。

## ✨ 核心功能 (Key Features)

### 1. 多平台解析与下载
*   **抖音/TikTok**: 支持分享链接的自动解析，可选择保留或去除水印。
*   **Twitter (X)**: 集成第三方 API，自动提取高质量视频地址。
*   **通用网页嗅探**: 对于无法直接解析的链接（如 Bilibili 或其他网页），内置的 WebView 嗅探器会自动加载页面并捕获媒体资源链接。

### 2. 智能剪贴板与交互
*   **一键粘贴解析**: "粘贴并解析下载" 按钮具备智能逻辑，能自动识别剪贴板中的新链接，同时保留用户手动编辑的内容，避免重复操作。
*   **自动文件名生成**: 智能提取分享文本中的标题和标签作为文件名，告别乱码。

### 3. 历史记录与智能重下 (Smart Redownload)
*   **完整记录**: 本地持久化存储下载历史，包含标题、时间、状态和原始来源。
*   **智能重下**: 针对由原始链接（Blob/CDN）过期的视频，支持通过“原始分享链接”自动唤醒解析器重新获取最新地址，彻底解决“链接失效”问题。
*   **内置播放**: 支持直接在历史记录中预览播放视频或图片。

### 4. 开发者工具 (Debug Mode)
*   **流量分析**: 内置调试页面，实时展示嗅探到的所有媒体资源 URL。
*   **抓包测试**: 提供独立的抓包测试入口，方便开发者分析网页结构和资源加载逻辑。

## 📱 界面布局 (UI Structure)

应用采用底部导航栏设计，从左到右依次为：

1.  **设置 (Settings)**: 自定义文件存储路径。
2.  **调试 (Debug)**: 查看嗅探器捕获的实时资源列表，用于排查问题。
3.  **记录 (History)**: 查看已下载任务，支持点击预览和智能重新下载。
4.  **解析 (Parser)**: 主页，提供链接输入、水印选项及下载控制。

## 🛠️ 技术栈 (Tech Stack)

*   **语言**: Kotlin
*   **UI 框架**: Jetpack Compose (Material Design 3)
*   **网络**: OkHttp
*   **核心组件**:
    *   `WebView` (用于 JS 注入和资源拦截)
    *   `Coroutines` (用于异步任务管理)
    *   `DownloadManager` (部分场景) & 自定义文件流写入

## 🚀 如何运行 (How to Run)

### 环境要求
*   Android Studio Iguana 或更高版本
*   Android SDK API 26+ (推荐 API 33)
*   JDK 17

### 步骤
1.  克隆或下载本项目。
2.  使用 Android Studio 打开项目根目录。
3.  等待 Gradle Sync 完成。
4.  连接 Android 设备或启动模拟器。
5.  点击运行 (Run 'app')。

## 📝 常见问题 (FAQ)

**Q: 为什么点击“重新下载”会跳转到解析页？**
A: 这是“智能重下”功能。因为视频的直链（Direct URL）通常有时效性，直接重试会失败。程序会自动将原始分享链接填入解析页并自动开始新的解析流程，以获取最新的有效下载地址。

**Q: 嗅探模式下载慢吗？**
A: 嗅探模式需要加载完整网页，速度取决于网速和目标网站的加载速度。程序内置了自动超时停止机制（8秒无新资源自动停止），兼顾效率与电量。

**Q: 支持哪些链接格式？**
A: 支持纯 URL (`https://...`) 或包含中文描述的分享文本（如抖音分享口令）。程序会自动正则提取其中的 URL。